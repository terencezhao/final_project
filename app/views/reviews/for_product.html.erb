<div class="page-header">
  <h1>
    Reviews for <a href="/products/<%= @product.id %>"><%= @product.name %></a>
  </h1>
  <% unless @reviews_for_product.any? { |review| review.user_id == current_user.id } %>
    <button class="btn btn-lg btn-success" data-toggle="collapse" data-target="#new_review">New Review</button>
  <% end %>
  <div id="new_review" class="collapse">
     <form action="/create_review" method="post" class="form-inline">
      <!-- Hidden input for authenticity token to protect from forgery -->
      <input name="authenticity_token" type="hidden" value="<%= form_authenticity_token %>">
      <!--Product ID is specified by default-->
      <input type="hidden" id="product_id" name="product_id" value="<%= @product.id %>"

      <!-- Label and input for quality -->
      <div class="form-group">
         <div class="input-group">
            <label for="quality" class="control-label">Quality</label>
            <select class="form-control" id="quality" name="quality">
              <option value="4">A</option>
              <option value="3">B</option>
              <option value="2">C</option>
              <option value="1">D</option>
              <option value="0">F</option>
            </select>
        </div>
      </div>

      <!-- Label and input for value -->
      <div class="form-group">
        <div class="input-group">
            <label for="value" class="control-label">Value</label>
            <select class="form-control" id="value" name="value">
              <option value="4">A</option>
              <option value="3">B</option>
              <option value="2">C</option>
              <option value="1">D</option>
              <option value="0">F</option>
            </select>
        </div>
      </div>

      <!-- Label and input for style -->
      <div class="form-group">
        <div class="input-group">
            <label for="style" class="control-label">Style</label>
            <select class="form-control" id="style" name="style">
              <option value="4">A</option>
              <option value="3">B</option>
              <option value="2">C</option>
              <option value="1">D</option>
              <option value="0">F</option>
            </select>
        </div>
      </div>

      <!-- Label and input for utility -->
      <div class="form-group">
        <div class="input-group">
            <label for="utility" class="control-label">Utility</label>
            <select class="form-control" id="utility" name="utility">
              <option value="4">A</option>
              <option value="3">B</option>
              <option value="2">C</option>
              <option value="1">D</option>
              <option value="0">F</option>
            </select>
        </div>
      </div>

      <!-- Label and input for enjoyment -->
      <div class="form-group">
        <div class="input-group">  
            <label for="enjoyment" class="control-label">Enjoyment</label>
            <select class="form-control" id="enjoyment" name="enjoyment">
              <option value="4">A</option>
              <option value="3">B</option>
              <option value="2">C</option>
              <option value="1">D</option>
              <option value="0">F</option>
            </select>
        </div>
      </div>

      <!-- Label and input for recommend -->
      <div class="checkbox">
        <label for="recommend">
          <input type="checkbox" id="recommend" name="recommend" value="1">
          Recommend
        </label>
      </div>

      <button class="btn btn-success">
        Create Review
      </button>
      or
      <a href="/reviews">Cancel</a>
    </form>
  </div>
</div>

<div class="row">
  <div class="col-md-12">
    <table class="table table-striped table-hover">
      <tr>
        <th>User</th>
        <th>Quality</th>
        <th>Value</th>
        <th>Style</th>
        <th>Utility</th>
        <th>Enjoyment</th>
        <th>Recommend</th>
        <th>Actions</th>
      </tr>

      <% @reviews_for_product.each do |review| %>
      <tr>
        <td><a href="/reviews/for_user/<%= review.user.id %>"><%= review.user.username %></a></td>
        <td><%= review.quality %></td>
        <td><%= review.value %></td>
        <td><%= review.style %></td>
        <td><%= review.utility %></td>
        <td><%= review.enjoyment %></td>
        <td>            
            <% if review.recommend %>
                <i class="fa fa-thumbs-up" style="font-size:36px;color:green"></i>
            <% else %>
                <i class="fa fa-thumbs-down" style="font-size:36px;color:red"></i>
            <% end %>
        </td>
        <td>
          <a href="/reviews/<%= review.id %>" class="btn btn-primary">Show</a>
          <a href="/reviews/<%= review.id %>/edit" class="btn btn-warning">Edit</a>
          <a href="/delete_review/<%= review.id %>" class="btn btn-danger" rel="nofollow">Delete</a>
        </td>
      </tr>
      <% end %>
      <tr>
        <td>AVERAGES</td>
        <td><%= number_with_precision(@quality_average, precision:2) %></td>
        <td><%= number_with_precision(@value_average, precision:2) %></td>
        <td><%= number_with_precision(@style_average, precision:2) %></td>
        <td><%= number_with_precision(@utility_average, precision:2) %></td>
        <td><%= number_with_precision(@enjoyment_average, precision:2) %></td>
        <td><%= number_to_percentage(@recommendation_average * 100.0, precision: 2) %></td>
      </tr>
    </table>
  </div>
</div>